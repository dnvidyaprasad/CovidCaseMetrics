{
	"name": "11 DSQL External Table",
	"properties": {
		"content": {
			"query": "CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'P@ssw0rd@123';\n\n-- Here we are use the Storage account key for authorization, with ADLS account name\nCREATE DATABASE SCOPED CREDENTIAL AzureStorageCredential\nWITH\n  IDENTITY = 'covid192zdzq2edqrlv2',\n  SECRET = '+ru8TPcPxGbr0thj/hqKerSqbZveZwgQBr7hRkKBSPBdl9rDDStfXug3VU5MaDkaz+2SgGOx4ryn+AStKhs0zg==';\n\n-- In the SQL pool, we can use Hadoop drivers to mention the source\n-- containername@accountname.dfs....\ndrop EXTERNAL DATA SOURCE dwh\nCREATE EXTERNAL DATA SOURCE dwh\nWITH (    LOCATION   = 'abfss://workspace@covid192zdzq2edqrlv2.dfs.core.windows.net',\n          CREDENTIAL = AzureStorageCredential,\n          TYPE = HADOOP\n)\n\n\n-- Here we are mentioning the file format as Parquet\nCREATE EXTERNAL FILE FORMAT parquetfile  \nWITH (  \n    FORMAT_TYPE = PARQUET,  \n    DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'  \n);\n\n\n-- Notice that the column names don't contain spaces\n-- When Azure Data Factory was used to generate these files, the column names could not have spaces\n\nDROP EXTERNAL TABLE [odsCountry]\nCREATE EXTERNAL TABLE [odsCountry]\n(\n    [CountryKey] Int NULL,\n    [Country]  [varchar](200) NULL,\n\t[CountryCode] [varchar](200) NULL,\n\t[Latitude] decimal(10,8) NULL,\n\t[Longitude] decimal(10,8) NULL,\n    InsertDT Date NULL,\n    UpdateDT Date NULL\n)\nWITH (\n LOCATION = '/ods/country.parquet',\n    DATA_SOURCE = dwh,  \n    FILE_FORMAT = parquetfile\n)\n\nDROP EXTERNAL TABLE [odsDate]\nCREATE EXTERNAL TABLE [odsDate]\n(\n    DateKey\tInt,\n    FullDate\tDate,\n    isWeekDay bit ,\n    DayOfWeek\tInt,\n    DayOfMonth\tInt,\n    DayOfQuarter\tInt,\n    DayOfYear\tInt,\n    DayName [varchar](200) ,\n    WeekOfYear\tInt,\n    WeekName [varchar](20) ,\n    MonthOfYear\tInt,\n    MonthName [varchar](20) ,\n    CalendarQuarter\tInt,\n    CalendarQuarterName [varchar](20) ,\n    CalendarYear\tInt,\n    FiscalMonth\tInt,\n    FiscalMonthName [varchar](20) ,\n    FiscalQuarter\tInt,\n    FiscalQuarterName [varchar](20) ,\n    FiscalYear\tInt\n)\nWITH (\n LOCATION = '/ods/date.parquet',\n    DATA_SOURCE = dwh,  \n    FILE_FORMAT = parquetfile\n)    \n\n\nDROP EXTERNAL TABLE [odsCaseMetrics]\nCREATE EXTERNAL TABLE [odsCaseMetrics]\n(\n    DateKey\t[varchar](20) ,\n    CountryKey\tInt NULL,\n    ID\tInt NULL,\n    Confirmed\tInt NULL,\n    Confirmed_Change\tInt NULL,\n    Deaths\tInt NULL,\n    Deaths_Change\tInt NULL,\n    Recovered\tInt NULL,\n    Recovered_Change\tInt NULL,\n    InsertDT\tDate NULL,\n    Source [varchar](20) NULL\n)\nWITH (\n LOCATION = '/ods/CaseMetrics/',  --CaseMetrics/CaseMetrics2022-02-12.parquet\n    DATA_SOURCE = dwh,  \n    FILE_FORMAT = parquetfile\n)      \n\n\n\nDROP EXTERNAL TABLE [odsPolicy]\nCREATE EXTERNAL TABLE [odsPolicy]\n(\n    DateKey\t[varchar](20) NULL,\n    CountryKey\tInt NULL,\n    Jurisdiction [varchar](200) NULL,\n    C1_Schoolclosing\tInt NULL,\n    C1_Flag_Schoolclosing\tInt NULL,\n    C2_Workplaceclosing\tInt NULL,\n    C2_Flag_Workplaceclosing\tInt NULL,\n    C3_Cancelpublicevents\tInt NULL,\n    C3_Flag_Cancelpublicevents\tInt NULL,\n    C4_Restrictionsongatherings\tInt NULL,\n    C4_Flag_Restrictionsongatherings\tInt NULL,\n    C5_Closepublictransport\tInt NULL,\n    C5_Flag_Closepublictransport\tInt NULL,\n    C6_Stayathomerequirements\tInt NULL,\n    C6_Flag_Stayathomerequirements\tInt NULL,\n    C7_Restrictionsoninternalmovement\tInt NULL,\n    C7_Flag_Restrictionsoninternalmovement\tInt NULL,\n    C8_Internationaltravelcontrols\tInt NULL,\n    E1_Incomesupport\tInt NULL,\n    E1_Flag_Incomesupport\tInt NULL,\n    E2_Debtcontractrelief\tInt NULL,\n    E3_Fiscalmeasures\t[varchar](200) NULL,\n    E4_Internationalsupport\t[varchar](200) NULL,\n    H1_Publicinformationcampaigns\tInt NULL,\n    H1_Flag_Publicinformationcampaigns\tInt NULL,\n    H2_Testingpolicy\tInt NULL,\n    H3_Contacttracing\t[varchar](200) NULL,\n    H4_Emergencyinvestmentinhealthcare\t[varchar](200) NULL,\n    H5_Investmentinvaccines\t[varchar](200) NULL,\n    H6_FacialCoverings\tInt NULL,\n    H6_Flag_FacialCoverings\tInt NULL,\n    H7_Vaccinationpolicy\tInt NULL,\n    H7_Flag_Vaccinationpolicy\tInt NULL,\n    H8_Protectionofelderlypeople\tInt NULL,\n    H8_Flag_Protectionofelderlypeople\tInt NULL,\n    M1_Wildcard\tInt NULL,\n    StringencyIndexForDisplay\t[varchar](200) NULL,\n    StringencyLegacyIndex\t[varchar](200) NULL,\n    StringencyLegacyIndexForDisplay\t[varchar](200) NULL,\n    GovernmentResponseIndex\t[varchar](200) NULL,\n    GovernmentResponseIndexForDisplay\t[varchar](200) NULL,\n    ContainmentHealthIndex\t[varchar](200) NULL,\n    ContainmentHealthIndexForDisplay\t[varchar](200) NULL,\n    EconomicSupportIndex\t[varchar](200) NULL,\n    EconomicSupportIndexForDisplay\t[varchar](200) NULL,\n    StringencyIndex\t[varchar](200) NULL,\n    InsertDT Date NULL\n)\nWITH (\n LOCATION = '/ods/policy/',  --policy/policy20211231.parquet\n    DATA_SOURCE = dwh,  \n    FILE_FORMAT = parquetfile\n)  \n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "covid19g6",
				"poolName": "covid19g6"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}